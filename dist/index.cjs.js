"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("tslib"),t=require("react"),r=require("@caffedpkg/microcore");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var a=o(t);const n=/(@media)(.*?)(\}\s+\})/gm,s=/(&)(.*?)(\})/gm,i=(e,t)=>{let r=e;const o=r.match(t)||[];return o&&o.length>0&&o.forEach((e=>{const t=r.indexOf(e);r=r.slice(0,t).concat(r.slice(t+e.length))})),[r,o]},l=e=>{try{const[t,r]=i(e,n),[o,a]=i(t,s);return{mediaQueries:r,psuedoClasses:a,keyValue:o.split(";").map((e=>e.trim())).filter((e=>e.length>0))}}catch(e){return console.warn(`Resultant CSS is invalid: ${e}`),{mediaQueries:[],psuedoClasses:[],keyValue:[]}}},c=(e,t)=>{const{keyValue:r,psuedoClasses:o,mediaQueries:a}=e;let n="";return n=r&&r.length>0?`.${t} { ${r.join(";\n").concat(";")} }\n`:"",n+=o&&o.length>0?`${o.join("\n")}\n`:"",n+=a&&a.length>0?`${a.join("\n")}\n`:"",n.replace(/&/gm,"."+t)},d=(e,t)=>{const r=document.createElement("style");return r.innerHTML=t,r.id=e,r},u=t.createContext(null),m=t.createContext(null),p=()=>t.useContext(m)||{},g=(e,o,n=[],s=!1)=>{const i=r.randomString(20,{filterRegex:/[0-9]/gm});return m=>{const{componentCssPrefix:g="micro-styled"}=m,f=`${g}-${i}`,h={className:i},{theme:b}=p(),{container:y}=null!==(v=t.useContext(u))&&void 0!==v?v:{container:document.head};var v;const x=c(l(r.removeComments(r.removeWhitespace(r.interpolate(o,n,b?Object.assign(Object.assign({},m),{config:h,theme:b}):Object.assign(Object.assign({},m),{config:h}))))),i),C=t.useRef(null);return t.useEffect((()=>{if(C.current){C.current.classList.add(i);const e=y.querySelector(`#${f}`);e?e.innerHTML=x:y.appendChild(d(f,x))}return()=>{var e,t;null===(e=C.current)||void 0===e||e.classList.remove(i),null===(t=y.querySelector(`#${f}`))||void 0===t||t.remove()}})),s?a.default.createElement(e,Object.assign({key:i,ref:C},m)):a.default.createElement(e,Object.assign({key:i,ref:C},m),m.children)}},f=(e,t=!1)=>(r,...o)=>g(e,r,o,t);var h={a:f("a"),address:f("address"),area:f("area"),article:f("article"),aside:f("aside"),audio:f("audio"),b:f("b"),base:f("base"),bdi:f("bdi"),bdo:f("bdo"),blockquote:f("blockquote"),br:f("br",!0),button:f("button"),canvas:f("canvas"),cite:f("cite"),code:f("code"),col:f("col"),colgroup:f("colgroup"),data:f("data"),datalist:f("datalist"),dd:f("dd"),del:f("del"),details:f("details"),dfn:f("dfn"),dialog:f("dialog"),div:f("div"),dl:f("dl"),dt:f("dt"),em:f("em"),embed:f("embed"),fieldset:f("fieldset"),figcaption:f("figcaption"),figure:f("figure"),footer:f("footer"),form:f("form"),h1:f("h1"),h2:f("h2"),h3:f("h3"),h4:f("h4"),h5:f("h5"),h6:f("h6"),header:f("header"),hgroup:f("hgroup"),hr:f("hr",!0),i:f("i"),iframe:f("iframe"),img:f("img",!0),input:f("input",!0),ins:f("ins",!0),kbd:f("kbd"),keygen:f("keygen"),label:f("label"),legend:f("legend"),li:f("li"),link:f("link"),main:f("main"),map:f("map"),mark:f("mark"),menu:f("menu"),menuitem:f("menuitem"),meter:f("meter"),nav:f("nav"),nobr:f("nobr"),noframes:f("noframes"),noscript:f("noscript"),object:f("object"),ol:f("ol"),optgroup:f("optgroup"),option:f("option"),output:f("output"),p:f("p"),picture:f("picture"),plaintext:f("plaintext"),pre:f("pre"),progress:f("progress"),q:f("q"),rp:f("rp"),rt:f("rt"),rtc:f("rtc"),ruby:f("ruby"),s:f("s"),samp:f("samp"),section:f("section"),select:f("select"),shadow:f("shadow"),small:f("small"),span:f("span"),strong:f("strong"),sub:f("sub"),summary:f("summary"),sup:f("sup"),table:f("table"),tbody:f("tbody"),td:f("td"),textarea:f("textarea"),tfoot:f("tfoot"),th:f("th"),thead:f("thead"),time:f("time"),tr:f("tr"),track:f("track"),tt:f("tt"),u:f("u"),ul:f("ul"),varEl:f("var"),video:f("video"),wbr:f("wbr")};exports.GlobalStyleSheet=e=>{const{globalCssPrefix:t="micro-styled-global",stylesheet:o}=e,n=r.randomString(10,{filterRegex:/[0-9]/gm,prefix:t+"-"});return a.default.createElement("style",{key:n,id:n},o)},exports.ThemeCacheProvider=r=>o=>{const{componentCssPrefix:n="micro-styled",globalCssPrefix:s=`${n}-global`,logger:i=globalThis.console.warn}=o,[l,c]=t.useState(document.head);return t.useEffect((()=>(e.__awaiter(void 0,void 0,void 0,(function*(){const e=l;try{const t="function"==typeof r?yield r():r;t&&e&&(c(t),Array.from(document.querySelectorAll(`style[id^='${n}']`)).filter((e=>!e.id.includes(s))).forEach((e=>{t.querySelector("#"+e.id)||t.appendChild(e)})))}catch(e){i(e)}})).catch(i),()=>{Array.from(l.querySelectorAll(`style[id^='${n}']`)).forEach((e=>e.remove()))})),[l]),a.default.createElement(u.Provider,{value:{container:l}},o.children)},exports.ThemeProvider=e=>t=>a.default.createElement(m.Provider,{value:{theme:e}},t.children),exports.createCSSObject=l,exports.createCSSString=c,exports.createStyleElement=d,exports.css=(e={})=>(t,...o)=>{const{theme:a}=p(),n=Object.assign(Object.assign({},e),{theme:a});return r.removeComments(r.interpolate(t,o,n))},exports.default=h,exports.mediaQueryRegex=n,exports.psuedoClassRegex=s,exports.removeWhitespace=e=>e.replace(/\s{1,}/gm," ").replace(/\n/gm,"").trim();
