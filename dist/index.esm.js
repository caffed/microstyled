import{__awaiter as e}from"tslib";import t,{createContext as r,useState as o,useEffect as n,useContext as a,useRef as i}from"react";import{removeComments as s,interpolate as l,randomString as c,removeWhitespace as d}from"@caffedpkg/microcore";const m=/(@media)(.*?)(\}\s+\})/gm,u=/(&)(.*?)(\})/gm,p=e=>e.replace(/\s{1,}/gm," ").replace(/\n/gm,"").trim(),g=(e,t)=>{let r=e;const o=r.match(t)||[];return o&&o.length>0&&o.forEach((e=>{const t=r.indexOf(e);r=r.slice(0,t).concat(r.slice(t+e.length))})),[r,o]},h=e=>{try{const[t,r]=g(e,m),[o,n]=g(t,u);return{mediaQueries:r,psuedoClasses:n,keyValue:o.split(";").map((e=>e.trim())).filter((e=>e.length>0))}}catch(e){return console.warn(`Resultant CSS is invalid: ${e}`),{mediaQueries:[],psuedoClasses:[],keyValue:[]}}},b=(e,t)=>{const{keyValue:r,psuedoClasses:o,mediaQueries:n}=e;let a="";return a=r&&r.length>0?`.${t} { ${r.join(";\n").concat(";")} }\n`:"",a+=o&&o.length>0?`${o.join("\n")}\n`:"",a+=n&&n.length>0?`${n.join("\n")}\n`:"",a.replace(/&/gm,"."+t)},f=(e,t)=>{const r=document.createElement("style");return r.innerHTML=t,r.id=e,r},y=r(null),v=r=>a=>{const{componentCssPrefix:i="micro-styled",globalCssPrefix:s=`${i}-global`,logger:l=globalThis.console.warn}=a,[c,d]=o(document.head);return n((()=>(e(void 0,void 0,void 0,(function*(){const e=c;try{const t="function"==typeof r?yield r():r;t&&e&&(d(t),Array.from(document.querySelectorAll(`style[id^='${i}']`)).filter((e=>!e.id.includes(s))).forEach((e=>{t.querySelector("#"+e.id)||t.appendChild(e)})))}catch(e){l(e)}})).catch(l),()=>{Array.from(c.querySelectorAll(`style[id^='${i}']`)).forEach((e=>e.remove()))})),[c]),t.createElement(y.Provider,{value:{container:c}},a.children)},k=r(null),j=()=>a(k)||{},x=e=>r=>t.createElement(k.Provider,{value:{theme:e}},r.children),$=(e={})=>(t,...r)=>{const{theme:o}=j(),n=Object.assign(Object.assign({},e),{theme:o});return s(l(t,r,n))},C=e=>{const{globalCssPrefix:r="micro-styled-global",stylesheet:o}=e,n=c(10,{filterRegex:/[0-9]/gm,prefix:r+"-"});return t.createElement("style",{key:n,id:n},o)},E=(e,r,o=[],m=!1)=>{const u=c(20,{filterRegex:/[0-9]/gm});return c=>{const{componentCssPrefix:p="micro-styled"}=c,g=`${p}-${u}`,v={className:u},{theme:k}=j(),{container:x}=null!==($=a(y))&&void 0!==$?$:{container:document.head};var $;const C=b(h(s(d(l(r,o,k?Object.assign(Object.assign({},c),{config:v,theme:k}):Object.assign(Object.assign({},c),{config:v}))))),u),E=i(null);return n((()=>{if(E.current){E.current.classList.add(u);const e=x.querySelector(`#${g}`);e?e.innerHTML=C:x.appendChild(f(g,C))}return()=>{var e,t;null===(e=E.current)||void 0===e||e.classList.remove(u),null===(t=x.querySelector(`#${g}`))||void 0===t||t.remove()}})),m?t.createElement(e,Object.assign({key:u,ref:E},c)):t.createElement(e,Object.assign({key:u,ref:E},c),c.children)}},q=(e,t=!1)=>(r,...o)=>E(e,r,o,t);var O={a:q("a"),address:q("address"),area:q("area"),article:q("article"),aside:q("aside"),audio:q("audio"),b:q("b"),base:q("base"),bdi:q("bdi"),bdo:q("bdo"),blockquote:q("blockquote"),br:q("br",!0),button:q("button"),canvas:q("canvas"),cite:q("cite"),code:q("code"),col:q("col"),colgroup:q("colgroup"),data:q("data"),datalist:q("datalist"),dd:q("dd"),del:q("del"),details:q("details"),dfn:q("dfn"),dialog:q("dialog"),div:q("div"),dl:q("dl"),dt:q("dt"),em:q("em"),embed:q("embed"),fieldset:q("fieldset"),figcaption:q("figcaption"),figure:q("figure"),footer:q("footer"),form:q("form"),h1:q("h1"),h2:q("h2"),h3:q("h3"),h4:q("h4"),h5:q("h5"),h6:q("h6"),header:q("header"),hgroup:q("hgroup"),hr:q("hr",!0),i:q("i"),iframe:q("iframe"),img:q("img",!0),input:q("input",!0),ins:q("ins",!0),kbd:q("kbd"),keygen:q("keygen"),label:q("label"),legend:q("legend"),li:q("li"),link:q("link"),main:q("main"),map:q("map"),mark:q("mark"),menu:q("menu"),menuitem:q("menuitem"),meter:q("meter"),nav:q("nav"),nobr:q("nobr"),noframes:q("noframes"),noscript:q("noscript"),object:q("object"),ol:q("ol"),optgroup:q("optgroup"),option:q("option"),output:q("output"),p:q("p"),picture:q("picture"),plaintext:q("plaintext"),pre:q("pre"),progress:q("progress"),q:q("q"),rp:q("rp"),rt:q("rt"),rtc:q("rtc"),ruby:q("ruby"),s:q("s"),samp:q("samp"),section:q("section"),select:q("select"),shadow:q("shadow"),small:q("small"),span:q("span"),strong:q("strong"),sub:q("sub"),summary:q("summary"),sup:q("sup"),table:q("table"),tbody:q("tbody"),td:q("td"),textarea:q("textarea"),tfoot:q("tfoot"),th:q("th"),thead:q("thead"),time:q("time"),tr:q("tr"),track:q("track"),tt:q("tt"),u:q("u"),ul:q("ul"),varEl:q("var"),video:q("video"),wbr:q("wbr")};export{C as GlobalStyleSheet,v as ThemeCacheProvider,x as ThemeProvider,h as createCSSObject,b as createCSSString,f as createStyleElement,$ as css,O as default,m as mediaQueryRegex,u as psuedoClassRegex,p as removeWhitespace};
